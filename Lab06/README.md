# Software Testing Lab06

## review table
|  | Valgrind | ASAN |
| -------- | -------- | -------- |
| Heap out-of-bounds | :heavy_check_mark:  | :heavy_check_mark:  |
| Stack out-of-bounds | :heavy_check_mark:  | :heavy_check_mark: |
| Global out-of-bounds | :x: | :heavy_check_mark: |
| Use-after-free | :heavy_check_mark:  | :heavy_check_mark: |
| Use-after-return |  :x: | :heavy_check_mark:  |

## Heap out-of-bounds

:notes:  code generated by ChatGPT
```
#include <stdlib.h>
#include <stdio.h>

int main() {
    int *ptr = (int*)malloc(sizeof(int) * 5);
    int i;

    for (i = 0; i <= 5; i++) {
        ptr[i] = i;
        printf("%d ", ptr[i]);
    }

    free(ptr);
    return 0;
}
```

### Valgrind
![](https://i.imgur.com/aJ5e79G.png)

$\Rightarrow$ **DO FIND** the problem of heap out-of-bounds

### ASAN
![](https://i.imgur.com/eNVQTLK.png)

$\Rightarrow$ **DO FIND** the problem of heap out-of-bounds

## Stack out-of-bounds
:notes:  code generated by ChatGPT
```
#include <stdlib.h>
#include <stdio.h>

void foo() {
    int *ptr = (int*)malloc(sizeof(int) * 5);
    int i;

    for (i = 0; i <= 5; i++) {
        ptr[i] = i;
        printf("%d ", ptr[i]);
    }

    free(ptr);
}

int main(){
    foo();
    return 0;
}
```

### Valgrind
![](https://i.imgur.com/6YOE8wx.png)

$\Rightarrow$ **DO FIND** the problem of stack out-of-bounds
### ASAN
![](https://i.imgur.com/I0rcfRB.png)

$\Rightarrow$ **DO FIND** the problem of stack out-of-bounds

## Global out-of-bounds
:notes: code generated by ChatGPT
```
#include <stdio.h>

int arr[5] = {1, 2, 3, 4, 5};

int main() {
  // global out-of-bounds read
  printf("%d\n", arr[5]);  // accessing index 5 is out-of-bounds

  // global out-of-bounds write
  arr[6] = 6;  // writing to index 6 is out-of-bounds

  return 0;
}

```

### Valgrind
![](https://i.imgur.com/tnqZCb8.png)
$\Rightarrow$ **DO NOT FIND** the problem of global out-of-bounds

### ASAN
![](https://i.imgur.com/iXkPsfY.png)
$\Rightarrow$ **DO FIND** the problem of global out-of-bounds

## Use-after-free
:notes:  code generated by ChatGPT
```
#include <stdio.h>
#include <stdlib.h>

int main() {
    int *ptr = (int*) malloc(sizeof(int));
    *ptr = 10;
    free(ptr);
    printf("%d\n", *ptr); // use after free
    return 0;
}
```

### Valgrind
![](https://i.imgur.com/7cIqUGg.png)
$\Rightarrow$ **DO FIND** the problem of use-after-free

### ASAN
![](https://i.imgur.com/Fw4VQRt.png)
$\Rightarrow$ **DO FIND** the problem of use-after-free

## Use-after-return
:notes:  code generated by ChatGPT
```
#include <stdlib.h>
#include <stdio.h>

int *use_after_return() {
    int i;
    int *ptr = &i;
    return ptr;
}

int main() {
    int *ptr = use_after_return();
    *ptr = 10; // 這裡會觸發 use after return 錯誤
    printf("%d\n", *ptr);
    return 0;
}
```
### Valgrind
![](https://i.imgur.com/ZeVRlQN.png)
$\Rightarrow$ **DO NOT FIND** the problem of use-after-return

### ASAN
![](https://i.imgur.com/Yc6dDlV.png)
$\Rightarrow$ **DO FIND** the problem of use-after-return

## stack buffer overflow
```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main() {
    char buffer[8];
    memset(buffer, 0, sizeof(buffer));
    buffer[32] = 'X';
    printf("%s\n", buffer);
    return 0;
}
```
### ASAN
![](https://i.imgur.com/i1vp3jl.png)
$\Rightarrow$ **DO NOT FIND**